# .github/workflows/classroom-maven.yml
name: Autograde

on:
  push:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up JDK 21 and cache Maven
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '21'
          cache: maven

      - name: Run tests with Maven Wrapper
        id: test
        run: |
          chmod +x mvnw
          ./mvnw test -B
        continue-on-error: true

      - name: Parse JUnit results
        id: parse
        if: always() && success() || failure()
        uses: dorny/test-reporter@v2
        with:
          name: JUnit Results
          path: "**/target/surefire-reports/**/*.xml"
          reporter: java-junit
          fail-on-empty: false

      - name: Report score back to Classroom
        uses: github-education-resources/autograding-command-grader@v1
        with:
          test-name: JUnit-Suite
          command: |
            if [ -z "$(find . -path '**/target/surefire-reports/**/*.xml' -type f)" ]; then
              echo "Passed 0 of 0 tests"
            else
              echo "Passed ${{ steps.parse.outputs.passed }} of ${{ steps.parse.outputs.total }} tests"
            fi
          max-score: ${{ steps.parse.outputs.total || 0 }}